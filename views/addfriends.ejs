<!DOCTYPE html>
<html lang="es">
<!-- HEAD -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS-->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap1.css">
    <!-- Font-awesome-->
    <link rel="stylesheet" type="text/css"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    
    <title>DevsCore </title>
</head>
<body class="app sidebar-mini">
<!-- Nav-->
<nav>
    <header class="app-header">
        <a class="app-header__logo" href="/">DevsCore</a>
        <!-- Sidebar toggle button-->
        <a class="app-sidebar__toggle" href="#" data-toggle="sidebar"></a>
        <!-- Nav Right Menu-->
        <ul class="app-nav">
            <li class="app-search">
                <form  method="get" action="/panel">
                    <input class="app-search__input" type="search" name="busqueda"
                           placeholder="Buscar Post">
                    <button class="app-search__button" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </form>

            </li>
            <!-- User Menu-->
            <li class="dropdown"><a class="app-nav__item" href="#"
                                    data-toggle="dropdown"><i class="fa fa-user fa-lg"></i> Perfil</a>
                <ul class="dropdown-menu settings-menu dropdown-menu-right">
                    <li><a class="dropdown-item" href="/users/perfil/?username={{ usuario.username }}"><i
                            class="fa fa-user fa-lg"></i> Perfil </a></li>
                    <li><a class="dropdown-item" href="/logout" id="logout"><i
                            class="fa fa-sign-out fa-lg"></i> Cerrar sesion </a>
                    </li>
                </ul>
            </li>
        </ul>
    </header>
    <!-- Sidebar menu-->
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <aside class="app-sidebar">
        <div class="app-sidebar__user">
            <img class="app-sidebar__user-avatar"
                 src="https://ssl.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png"
                 alt="User Image" width="48" height="48">
           
            <div>
                <h4 style="color: aliceblue;"><%= data.data.names %> </h4>
                <h6 style="color: aliceblue;"><%= data.data.f_last_name %> <%= data.data.s_last_name %>  </h6>

            </div>
        </div>
        <ul class="app-menu">
            <li><a class="app-menu__item" href="/"><i
                    class="app-menu__icon fa fa-dashboard"></i><span
                    class="app-menu__label">Panel</span></a></li>
            <li class="treeview"><a id="posts" class="app-menu__item" href="#"
                                    data-toggle="treeview"><i class="app-menu__icon fa fa-edit"></i><span
                    class="app-menu__label">Mis datos</span><i
                    class="treeview-indicator fa fa-angle-right"></i></a>
                <ul class="treeview-menu" id="desplieguePosts">
                    <li><a class="treeview-item" href=""><i
                            class="icon fa fa-circle-o"></i> Agregar Informacion </a></li>
                    <li><a class="treeview-item" href="/post/list"><i
                            class="icon fa fa-circle-o"></i> Editar Informacion </a>
                    </li>
                </ul>
            </li>
            <li class="treeview"><a id="usuarios" class="app-menu__item" href="#"
                                    data-toggle="treeview"><i class="app-menu__icon fa fa-users"></i><span
                    class="app-menu__label">Amigos</span><i
                    class="treeview-indicator fa fa-angle-right"></i></a>
                <ul class="treeview-menu" id="despliegueUsuarios">
                    <li><a class="treeview-item" type="button" href= "myFriends/<%= data.data.id_user %> "  ><i
                            class="icon fa fa-circle-o"></i> Mis amigos </a></li>
                    <li><a class="treeview-item" href="/views/users/lista-peticiones.html"><i
                            class="icon fa fa-circle-o"></i> Peticiones de amistad </a> </li>
                    
                </ul>
            </li>
        </ul>
    </aside>
</nav>
    <!-- Contenido -->
    <main class="app-content"> <!-- Titulo-Cabecera -->
        <div class="app-title">
            <div>
                <h1>
                    <i class="fa fa-dashboard"></i> Bienvenido
                </h1>
                <p>A el lugar donde todos nos conectamos</p>
            </div>
        </div>
        <% if(friends.length > 0) {%>
            
        <div class="row" style="display: flex; justify-content: space-around; align-items: center; ">
            <% for(let i =0 ; i < friends.length ; i++) {%> 
            <div class="col-md-6 col-lg-4">
                
                <div class="widget-small primary coloured-icon">
                    <i class="icon fa fa-users fa-3x"></i>
                    
                    <div class="info" style="display: flex; justify-content:space-around; align-items: center;">
                        <h4><%= friends[i].names %> </h4>
                        <p>
                            <button class="btn btn-dark" onclick="sendReq( )">Agregar</button>
                        </p>
                    </div>
                    
                </div>
                
            </div>
            <% } %> 
        <% } else { %> 
            <div class="col-md-6 col-lg-3">
                <div class="widget-small danger coloured-icon">
                    <i class="icon fa fa-comment fa-3x"></i>
                    <div class="info">
                        <h4>Ooopss!</h4>
                        <p>
                            <b>Parece que aun no tienes amigos</b>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    <% } %> 
        <br>
    
    
    
    </main>
        
<!-- JS -->
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src = "/js/main.js"></script>

<script>
    var mensaje = getUrlParameter('mensaje');
    var tipoMensaje = getUrlParameter('tipoMensaje');
    if (mensaje != "") {
        if (tipoMensaje == "") {
            tipoMensaje = 'alert-info';
            $.notify({
                title: "",
                message: mensaje,
                icon: 'fa fa-check'
            },{
                type: "info"
            });
        }else if(tipoMensaje == "error"){
            $.notify({
                title: "Error: ",
                message: mensaje,
                icon: 'fa fa-error'
            },{
                type: "danger"
            });
        }


    }

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };

    async function sendReq(id_friend,id_user,name){

        let request = {
            id_friend: id_friend,
            id_user: id_user,
            status: 0,
            name : name
        }
        console.log(request);
        let res = await fetch('http://localhost:2500/friends', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(request)
        });
        console.log(sendReq)
    }

</script>

</body>

</html>
